# baal-tokens

Intent: Playground to experiment with different summoner, token and shaman configurations

It uses a HOS (Higher Order Summoner) that wraps our indexed summoners from the baal repo

Initial tests are configured and examples of using the base summoner or the baal and vault summoner.

## HOS (Higher Order Summoner):
BaseHOS: Abstract that handles summonBaalFromReferrer which takes encoded bytes to setup tokens (loot/shares) and multiple shamans.

**FixedLootHOS**: summoner is an example of deploying a baal, side vault, a custom token (Fixed loot)

**OnboarderHOS**: Summoner is an example of using the base sumoner (no side vault) and deploying a standard loot/shares token with a
example of a simple onboarding shaman (eth to shares or loot)

## initial examples

### Shamans:

Shaman init params encoding:
```js
const initializationShamanParams = abiCoder.encode(
    ["address[]", "uint256[]", "bytes[]"],
    [shamanConfig.singletonAddress, shamanConfig.permissions, shamanConfig.setupParams],
  );
```

**ClaimShaman**: a claim shaman that allows NFT holders to claim shares/loot to a ERC6551 TBA (Token Bound Account)
```sol
(address _nftAddress, address _registry, address _tbaImp, uint256 _lootPerNft, uint256 _sharesPerNft) = abi
            .decode(_initParams, (address, address, address, uint256, uint256));
```

**OnboarderShaman**: yeet Eth for shares or loot 
```sol
(uint256 _expiry, uint256 _multiply, uint256 _minTribute, bool _isShares) = abi.decode(
            _initParams,
            (uint256, uint256, uint256, bool)
        );
```

**Community Veto**: Loot holders "stake" against a proposal while in voting, if it hits some threshold it can be cancelled. Kinda a less nuclear rq option. Uses the governor loot token.
```sol
uint256 _thresholdPercent = abi.decode(_initParams, (uint256));
```

### tokens

token init parameters encoding:
```js
const sharesParams = abiCoder.encode(["string", "string"], [sharesConfig.name, sharesConfig.symbol]);
  const initializationShareTokenParams = abiCoder.encode(
    ["address", "bytes"],
    [sharesConfig.singletonAddress, sharesParams],
  );
```

**FixedLoot**: A loot token with a fixed supply that is minted upfront between 2+ addresses
```sol
(
            string memory name_,
            string memory symbol_,
            address[] memory initialHolders,
            uint256[] memory initialAmounts
        ) = abi.decode(params, (string, string, address[], uint256[]));
```

**GovernorLoot**: allows snapshot to be called by baal or governor shaman

## Deployments

| Contract | Sepolia | Base  |
|---------:|---------|-------|
| YEETER_SINGLETON   | 0x62ff4ca410e9e58f5ce8b2ad03695ef0ad990381 | 0x8D60971eFf778966356c1cADD76d525E7B25cc6b |
| GOV_LOOT_SINGLETON | 0x8a4a9e36106ee290811b89e06e2fafe913507965 | 0x59a7C71221d05e30b9d7981AB83f0A1700e51Af8 |
| YEET24_SINGLETON   | 0x69eEA5adD040311C0aABb41C772423b87fadF32A | 0x885F45A8F5227FC11f17a007cb058Bd8f4c858bE |
| YEET24_SUMMONER    | 0x78cf150b2E684562C0510C0b699edE1DCD69b983 | 0x788C55D87a416F391E93a986AbB1e2b2960d0079 |

---

## Development Instructions

### Pre Requisites

Before being able to run any command, you need to create a `.env` file and set a BIP-39 compatible mnemonic as an
environment variable. You can follow the example in `.env.example`. If you don't already have a mnemonic, you can use
this [website](https://iancoleman.io/bip39/) to generate one.

Then, proceed with installing dependencies:

```sh
$ pnpm install
```

### Compile

Compile the smart contracts with Hardhat:

```sh
$ pnpm compile
```

### TypeChain

Compile the smart contracts and generate TypeChain bindings:

```sh
$ pnpm typechain
```

### Test

Run the tests with Hardhat:

```sh
$ pnpm test
```

### Lint Solidity

Lint the Solidity code:

```sh
$ pnpm lint:sol
```

### Lint TypeScript

Lint the TypeScript code:

```sh
$ pnpm lint:ts
```

### Coverage

Generate the code coverage report:

```sh
$ pnpm coverage
```

### Report Gas

See the gas usage per unit test and average gas per method call:

```sh
$ REPORT_GAS=true pnpm test
```

### Clean

Delete the smart contract artifacts, the coverage reports and the Hardhat cache:

```sh
$ pnpm clean
```

### Local Deployment

```sh
$ pnpm hardhat deploy --tags Infra,BaalSummoner,BaalAndVaultSummoner,GovernorLoot,Yeeter2,Yeet24ShamanModule,Yeet24HOS
```

### Deploy

Deploy the contracts to Hardhat Network:

```sh
$ pnpm deploy:contracts
```

### Tasks

TBD

## Tips

### Syntax Highlighting

If you use VSCode, you can get Solidity syntax highlighting with the
[hardhat-solidity](https://marketplace.visualstudio.com/items?itemName=NomicFoundation.hardhat-solidity) extension.

## Using GitPod

[GitPod](https://www.gitpod.io/) is an open-source developer platform for remote development.

To view the coverage report generated by `pnpm coverage`, just click `Go Live` from the status bar to turn the server
on/off.

## Local development with Ganache

### Install Ganache

```sh
$ npm i -g ganache
```

### Run a Development Blockchain

```sh
$ ganache -s test
```

> The `-s test` passes a seed to the local chain and makes it deterministic

Make sure to set the mnemonic in your `.env` file to that of the instance running with Ganache.

## License

This project is licensed under MIT.
